_your zenodo badge here_

# xu_etal_2022_tbd

**LA County Building Anthropogenic Heat During Heat Waves**

Yujie Xu<sup>1</sup>, Pouya Vahmani<sup>1</sup>, Tianzhen Hong\*, Andy Jones<sup>1</sup>

<sup>1 </sup> LBNL

\* corresponding author:  thong@lbl.gov

## Abstract
TBD

## Journal reference
TBD

## Code reference
<!-- References for each minted software release for all code involved.   -->

<!-- These are generated by Zenodo automatically when conducting a release when Zenodo has been linked to your GitHub repository. The Zenodo references are built by setting the author order in order of contribution to the code using the author's GitHub user name.  This citation can, and likely should, be edited without altering the DOI. -->

<!-- If you have modified a codebase that is outside of a formal release, and the modifications are not planned on being merged back into a version, fork the parent repository and add a `.<shortname>` to the version number of the parent and construct your own name.  For example, `v1.2.5.hydro`. -->

<!-- Human, I.M. (2021, April 14). Project/repo:v0.1.0 (Version v0.1.0). Zenodo. http://doi.org/some-doi-number/zenodo.7777777 -->

to be added

## Data reference

### Input data
LA buildings
- LA building charateristics: Assessor_Parcels_Data_-_2019.csv, from Dropbox
- LA building geometry: LARIAC6_LA_County.geojson

Climate
- WRF climate data (in a 12 km x 12 km grid system): from Pouya

Prototype Building Models

- Lookup tables to remap types between assessor data, prototype building models, and Energy Atlas building types in verification

### Output data
grid level data heat emission data: fixme add

## Contributing modeling software
| Model | Version | Repository Link | DOI |
|-------|---------|-----------------|-----|
| EnergyPlus | 22.1 | https://github.com/NREL/EnergyPlus |  |

## Reproduce my experiment

The following is an overview of the workflow

![workflow](figures/workflow.png)

Following the steps to reproduce the analysis

1. Compile a LA county geojson file with building footprint, type, vintage,
   number of stories, and footprint area using the geometry and assessor data
   files from the Dropbox folder "City Data/LA".
2. Acquire WRF climate data (in a 12 km x 12 km grid system)
3. Convert the WRF climate data of the historic forcing to epw. 
    1. Untar the "M02_EnergyPlus_Forcing_Historical_LowRes*" folder. This
       creates a folder <A> to hold all the files from the tar ball
    2. Run 0_mv_inputs.py to create folder structure and move files to
       corresponding folders. "forcing_folder" is set to be where the WRF data
       is extracted, i.e. <A> from above.
    3. Copy the "USA_CA_Los.Angeles.Intl.AP.722950_TMY3.epw" into folder <A>
    4. Run 2_wrf_to_epw.py to before this line. Note that the WRF_FOLDER at the
    beginning should be set to <A> as well. df_wrf_data =
    pd.read_csv(os.path.join(WRF_FOLDER, 'time_series', 'LA-SOLAR.csv'),
    sep=',', encoding='UTF-8')
    5. Get solar radiation input with get_solar_input.R. This creates a file
       "LA-SWDOWN_input_to_excel.csv" in the <a>/time_series folder. The file
       looks like this
    6. Open the file and copy data to the excel tool Los_Angeles_TMY_2010s Solar
     irradiance.xlsx. Note that for leap year, we should not copy in the Feb 29
     data, as the excel tool won't accept that. Also due to UTC to local time
     conversion, there is a time shift, the UTC time 2018 does not cover the
     whole local time 2018. We’ll use the year-end data of the previous year to
     fill in for the missing hours of the current end of year. Then paste the W,
     X, Y column in sheet "Output – Isotropic sky" to
     "LA-SWDOWN_input_to_excel.csv". For Feb 29 data, paste it in the "input"
     sheet in place of Feb 28, then get the output three solar component of Feb
     28 from "Output – Isotropic sky", and paste them in the Feb 29 slots in the
     csv. Change the column names of the three solar component to "sw_normal",
     "sw_dif", and "sw_dir". Save the csv file as LA-SOLAR.csv
    7. Go back to 2_wrf_to_epw.py, now the previous line should run through and
       read in solar data to df_wrf_data.
4. Assign the nearest grid point to each building. The epw files for the
   assigned grid point will be used in the simulation of the target building.
5. For each building type-vintage combination in each grid cell, simulate the
   historic forcing. There are xx possible prototype buildings and 3 possible
   vintages, but we will only simulate the type-vintage combination appearing in
   each grid cell (see xx for the mapping from grid cells to type-vintage
   combination). Use "3_write_baseline_idf" from
   [im3 repo from Xuan](https://github.com/LBNL-ETA/im3-wrf/blob/main/3_write_baseline_idf.ipynb) to
   create EnergyPlus models.
7. Adjust prototype models
    - Change the design condition, using 3_idf_preprocess.R. The script first
      copies the idf files from input_data/annual_WRF into
      intermediate_data/idf_to_modify, then change the design day and location
      of the idf files then output them to
      intermediate_data/idf_change_design_day
    - Add run period and output variables using 3_write_baseline_idf.py: takes
      idf from intermediate_data/idf_change_design_day and add runperiod and
      output variables, outputs to intermediate_data/idf_add_sim_period_output
    - Remove un-used dependencies from files: 3_replace_schedule_csv_path.R
    - Create heavy and light manufacturing facility models by adjusting the
      electric and gas equipment to match the EUI of the MECS 75th and 25th
      percentile
      - retrieve the 25th and 75th percentile using get_manufacturing_energy_stats.R
      - adjust the model electricity and gas equipment using 3_get_manufacturing_idf.R
    - Update model version using idfVersionUpdater.exe
    - fix errors in the Religious model by running 3_fix_religious.R. The
      original model have some errors of missing objects and wrong value for the
      start day in the RunPeriod object.
    - fix a field in nursing home model using 3_correct_nursingHome.R
    - change the year and "Day of Week for Start Day" in the RunPeriod object to
      match the actual simulation year
8. Use run_sim.py to run simulations
9. Validation with measured and other data source: fixme: add rmd
10. Produce grid-level heat emission data.

<!-- Run the following scripts in the `workflow` directory to re-create this experiment: -->

<!-- | Script Name | Description | How to Run | -->
<!-- | --- | --- | --- | -->
<!-- | `step_one.py` | Script to run the first part of my experiment | `python3 step_one.py -f /path/to/inputdata/file_one.csv` | -->
<!-- | `step_two.py` | Script to run the last part of my experiment | `python3 step_two.py -o /path/to/my/outputdir` | -->

<!-- 4. Download and unzip the output data from my experiment [Output data](#output-data) -->
<!-- 5. Run the following scripts in the `workflow` directory to compare my outputs to those from the publication -->

<!-- | Script Name | Description | How to Run | -->
<!-- | --- | --- | --- | -->
<!-- | `compare.py` | Script to compare my outputs to the original | `python3 compare.py --orig /path/to/original/data.csv --new /path/to/new/data.csv` | -->

## Reproduce my figures
Fixme: add rmd files
<!-- Use the scripts found in the `figures` directory to reproduce the figures used in this publication. -->

<!-- | Script Name | Description | How to Run | -->
<!-- | --- | --- | --- | -->
<!-- | `generate_figures.py` | Script to generate my figures | `python3 generate_figures.py -i /path/to/inputs -o /path/to/outuptdir` | -->
